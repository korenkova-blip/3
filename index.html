<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–°–∏–º—É–ª—è—Ç–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º—É –ú–∞—Ä–∫–æ–≤–∞</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 20px; text-align: center; background: #f0f4ff; color: #222; }
    input[type="text"] { padding: 6px; border-radius: 6px; border: 1px solid #888; margin: 4px; }
    table { border-collapse: collapse; margin: 10px auto; background-color: #fff; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #999; padding: 6px; text-align: center; }
    .controls { margin-top: 10px; }
    button { margin: 5px; padding: 8px 16px; background: #1976d2; color: #fff; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; }
    button:hover { background: #1565c0; }
    .activeRow { background-color: #fff176 !important; }
    td button { padding: 4px 8px; font-size: 12px; background: #e53935; border-radius: 4px; color: #fff; }
    td button:hover { background: #c62828; }
    .moveBtn { background: #8e24aa; }
    .moveBtn:hover { background: #6a1b9a; }
    .instructions { max-width: 800px; margin: 10px auto; text-align: left; font-size: 14px; background: #fff3cd; border: 1px solid #ffeeba; padding: 10px; border-radius: 6px; display: none; }
    .toggleBtn { background: #ffa000; }
    .toggleBtn:hover { background: #ef6c00; }
  </style>
</head>
<body>

<h1>üìù –°–∏–º—É–ª—è—Ç–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º—É –ú–∞—Ä–∫–æ–≤–∞</h1>

<h3>–í—Ö—ñ–¥–Ω–µ —Å–ª–æ–≤–æ:</h3>
<input type="text" id="inputWord" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: aab">
<button onclick="insertWord()">–í—Å—Ç–∞–≤–∏—Ç–∏</button>

<div>
  <h3>–ü–æ—Ç–æ—á–Ω–µ —Å–ª–æ–≤–æ:</h3>
  <div id="currentWord" style="font-size:20px; font-weight:bold; margin:10px;"></div>
</div>

<button class="toggleBtn" onclick="toggleInstructions()">–ü–æ–∫–∞–∑–∞—Ç–∏ / –°—Ö–æ–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é</button>
<div class="instructions" id="instructions">
  <b>–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è:</b>
  <ul>
    <li>–ö–æ–∂–Ω–µ –ø—Ä–∞–≤–∏–ª–æ –º–∞—î –≤–∏–≥–ª—è–¥ <code>–ª—ñ–≤–∞ ‚Üí –ø—Ä–∞–≤–∞</code>. –Ø–∫—â–æ –ø–æ–∑–Ω–∞—á–µ–Ω–æ ¬´–ö—ñ–Ω—Ü–µ–≤–µ¬ª, –∞–ª–≥–æ—Ä–∏—Ç–º –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –π–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è.</li>
    <li>–ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ <b>–°—Ç–∞—Ä—Ç</b> –∞–ª–≥–æ—Ä–∏—Ç–º –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–æ–≤–Ω—ñ—Å—Ç—é –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è.</li>
    <li><b>–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫</b> –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –ø–æ–∫—Ä–æ–∫–æ–≤–æ.</li>
    <li>–ö–Ω–æ–ø–∫–∏ ‚¨ÜÔ∏è —Ç–∞ ‚¨áÔ∏è –∑–º—ñ–Ω—é—é—Ç—å –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–∞–≤–∏–ª —É —Ç–∞–±–ª–∏—Ü—ñ.</li>
    <li>–ö–Ω–æ–ø–∫–∞ ‚ùå –≤–∏–¥–∞–ª—è—î –ø—Ä–∞–≤–∏–ª–æ.</li>
    <li>–ö–Ω–æ–ø–∫–∞ <b>–°–∫–∏–Ω—É—Ç–∏</b> –≤—ñ–¥–Ω–æ–≤–ª—é—î –ø–æ—á–∞—Ç–∫–æ–≤–µ —Å–ª–æ–≤–æ, <b>–û—á–∏—Å—Ç–∏—Ç–∏</b> ‚Äî –ø–æ–≤–Ω—ñ—Å—Ç—é –æ—á–∏—â–∞—î.</li>
  </ul>
</div>

<h3>–ü—Ä–æ–≥—Ä–∞–º–∞ (–ø—Ä–∞–≤–∏–ª–∞):</h3>
<table id="programTable">
  <thead>
    <tr>
      <th>‚Ññ</th>
      <th>–õ—ñ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞</th>
      <th>–ü—Ä–∞–≤–∞ —á–∞—Å—Ç–∏–Ω–∞</th>
      <th>–ö—ñ–Ω—Ü–µ–≤–µ</th>
      <th>–î—ñ—è</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td><input type="text" value="ab"></td>
      <td><input type="text" value="ba"></td>
      <td><input type="checkbox"></td>
      <td>
        <button onclick="moveRow(this, -1)" class="moveBtn">‚¨ÜÔ∏è</button>
        <button onclick="moveRow(this, 1)" class="moveBtn">‚¨áÔ∏è</button>
        <button onclick="deleteRow(this)">‚ùå</button>
      </td>
    </tr>
    <tr>
      <td>2</td>
      <td><input type="text" value="aa"></td>
      <td><input type="text" value="b"></td>
      <td><input type="checkbox" checked></td>
      <td>
        <button onclick="moveRow(this, -1)" class="moveBtn">‚¨ÜÔ∏è</button>
        <button onclick="moveRow(this, 1)" class="moveBtn">‚¨áÔ∏è</button>
        <button onclick="deleteRow(this)">‚ùå</button>
      </td>
    </tr>
  </tbody>
</table>
<button onclick="addRow()">–î–æ–¥–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–æ</button>

<div class="controls">
  <button onclick="startMachine()">–°—Ç–∞—Ä—Ç</button>
  <button onclick="nextStep()">–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫</button>
  <button onclick="resetMachine()">–°–∫–∏–Ω—É—Ç–∏</button>
  <button onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
</div>

<script>
let currentWord = "";
let initialWord = "";
let halted = false;

function insertWord() {
  initialWord = document.getElementById("inputWord").value.trim();
  currentWord = initialWord;
  halted = false;
  document.getElementById("currentWord").innerText = currentWord;
  highlightRow(0);
}

function resetMachine() {
  if (!initialWord) {
    alert("–°–ø–æ—á–∞—Ç–∫—É –≤–≤–µ–¥—ñ—Ç—å –≤—Ö—ñ–¥–Ω–µ —Å–ª–æ–≤–æ.");
    return;
  }
  currentWord = initialWord;
  halted = false;
  document.getElementById("currentWord").innerText = currentWord;
  highlightRow(0);
}

function clearAll() {
  document.getElementById("inputWord").value = "";
  currentWord = "";
  initialWord = "";
  halted = false;
  document.getElementById("currentWord").innerText = "";
  highlightRow(0);
  document.querySelector("#programTable tbody").innerHTML = "";
}

function getProgram() {
  let rows = document.querySelectorAll("#programTable tbody tr");
  let program = [];
  rows.forEach(row => {
    let left = row.cells[1].querySelector("input").value;
    let right = row.cells[2].querySelector("input").value;
    let end = row.cells[3].querySelector("input").checked;
    program.push({left: left, right: right, end: end});
  });
  return program;
}

function highlightRow(rowNum) {
  let rows = document.querySelectorAll("#programTable tbody tr");
  rows.forEach((row, idx) => {
    row.classList.toggle("activeRow", idx === rowNum - 1);
  });
}

function nextStep() {
  if (halted) {
    alert("–ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–≤–µ—Ä—à–∏–≤—Å—è.");
    return;
  }
  let program = getProgram();
  let applied = false;
  for (let i = 0; i < program.length; i++) {
    let {left, right, end} = program[i];
    let pos = currentWord.indexOf(left);
    if (pos !== -1) {
      currentWord = currentWord.replace(left, right);
      document.getElementById("currentWord").innerText = currentWord;
      highlightRow(i+1);
      applied = true;
      if (end) {
        halted = true;
        alert("–ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–≤–µ—Ä—à–∏–≤—Å—è (–∫—ñ–Ω—Ü–µ–≤–µ –ø—Ä–∞–≤–∏–ª–æ).");
      }
      return;
    }
  }
  if (!applied) {
    halted = true;
    alert("–ñ–æ–¥–Ω–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–µ. –ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–≤–µ—Ä—à–∏–≤—Å—è.");
  }
}

function startMachine() {
  while (!halted) {
    nextStep();
  }
}

function addRow() {
  let table = document.querySelector("#programTable tbody");
  let rowCount = table.rows.length + 1;
  let row = table.insertRow();
  row.innerHTML = `
    <td>${rowCount}</td>
    <td><input type="text"></td>
    <td><input type="text"></td>
    <td><input type="checkbox"></td>
    <td>
      <button onclick="moveRow(this, -1)" class="moveBtn">‚¨ÜÔ∏è</button>
      <button onclick="moveRow(this, 1)" class="moveBtn">‚¨áÔ∏è</button>
      <button onclick="deleteRow(this)">‚ùå</button>
    </td>
  `;
}

function deleteRow(btn) {
  let row = btn.parentNode.parentNode;
  row.parentNode.removeChild(row);
  renumberRows();
}

function moveRow(btn, dir) {
  let row = btn.parentNode.parentNode;
  let tbody = row.parentNode;
  let index = Array.from(tbody.children).indexOf(row);
  let newIndex = index + dir;
  if (newIndex < 0 || newIndex >= tbody.children.length) return;
  tbody.insertBefore(row, tbody.children[newIndex + (dir > 0 ? 1 : 0)]);
  renumberRows();
}

function renumberRows() {
  let rows = document.querySelectorAll("#programTable tbody tr");
  rows.forEach((r, idx) => { r.cells[0].innerText = idx + 1; });
}

function toggleInstructions() {
  let inst = document.getElementById("instructions");
  inst.style.display = inst.style.display === "none" ? "block" : "none";
}
</script>

</body>
</html>
