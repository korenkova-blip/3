<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–°–∏–º—É–ª—è—Ç–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º—É –ú–∞—Ä–∫–æ–≤–∞</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 20px; text-align: center; background: #f0f4ff; color: #222; }
    input[type="text"] { padding: 6px; border-radius: 6px; border: 1px solid #888; margin: 4px; }
    table { border-collapse: collapse; margin: 10px auto; background-color: #fff; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #999; padding: 6px; text-align: center; }
    .controls { margin-top: 10px; }
    button { margin: 5px; padding: 10px 20px; background: #1976d2; color: #fff; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; }
    button:hover { background: #1565c0; }
    .activeRow { background-color: #fff176 !important; }
    td button { padding: 5px 10px; font-size: 12px; background: #e53935; border-radius: 4px; }
    td button:hover { background: #c62828; }
  </style>
</head>
<body>

<h1>üìù –°–∏–º—É–ª—è—Ç–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º—É –ú–∞—Ä–∫–æ–≤–∞</h1>

<h3>–í—Ö—ñ–¥–Ω–µ —Å–ª–æ–≤–æ:</h3>
<input type="text" id="inputWord" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: aab">
<button onclick="insertWord()">–í—Å—Ç–∞–≤–∏—Ç–∏</button>

<div>
  <h3>–ü–æ—Ç–æ—á–Ω–µ —Å–ª–æ–≤–æ:</h3>
  <div id="currentWord" style="font-size:20px; font-weight:bold; margin:10px;"></div>
</div>

<h3>–ü—Ä–æ–≥—Ä–∞–º–∞ (–ø—Ä–∞–≤–∏–ª–∞):</h3>
<table id="programTable">
  <thead>
    <tr>
      <th>‚Ññ</th>
      <th>–õ—ñ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞</th>
      <th>–ü—Ä–∞–≤–∞ —á–∞—Å—Ç–∏–Ω–∞</th>
      <th>–ö—ñ–Ω—Ü–µ–≤–µ</th>
      <th>–î—ñ—è</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td><input type="text" value="ab"></td>
      <td><input type="text" value="ba"></td>
      <td><input type="checkbox"></td>
      <td><button onclick="deleteRow(this)">‚ùå</button></td>
    </tr>
    <tr>
      <td>2</td>
      <td><input type="text" value="aa"></td>
      <td><input type="text" value="b"></td>
      <td><input type="checkbox" checked></td>
      <td><button onclick="deleteRow(this)">‚ùå</button></td>
    </tr>
  </tbody>
</table>
<button onclick="addRow()">–î–æ–¥–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–æ</button>

<div class="controls">
  <button onclick="startMachine()">–°—Ç–∞—Ä—Ç</button>
  <button onclick="nextStep()">–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫</button>
  <button onclick="resetMachine()">–°–∫–∏–Ω—É—Ç–∏</button>
  <button onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
</div>

<script>
let currentWord = "";
let initialWord = "";
let halted = false;

function insertWord() {
  initialWord = document.getElementById("inputWord").value.trim();
  currentWord = initialWord;
  halted = false;
  document.getElementById("currentWord").innerText = currentWord;
  highlightRow(0);
}

function resetMachine() {
  if (!initialWord) {
    alert("–°–ø–æ—á–∞—Ç–∫—É –≤–≤–µ–¥—ñ—Ç—å –≤—Ö—ñ–¥–Ω–µ —Å–ª–æ–≤–æ.");
    return;
  }
  currentWord = initialWord;
  halted = false;
  document.getElementById("currentWord").innerText = currentWord;
  highlightRow(0);
}

function clearAll() {
  document.getElementById("inputWord").value = "";
  currentWord = "";
  initialWord = "";
  halted = false;
  document.getElementById("currentWord").innerText = "";
  highlightRow(0);
  document.querySelector("#programTable tbody").innerHTML = "";
}

function getProgram() {
  let rows = document.querySelectorAll("#programTable tbody tr");
  let program = [];
  rows.forEach(row => {
    let left = row.cells[1].querySelector("input").value;
    let right = row.cells[2].querySelector("input").value;
    let end = row.cells[3].querySelector("input").checked;
    program.push({left: left, right: right, end: end});
  });
  return program;
}

function highlightRow(rowNum) {
  let rows = document.querySelectorAll("#programTable tbody tr");
  rows.forEach((row, idx) => {
    row.classList.toggle("activeRow", idx === rowNum - 1);
  });
}

function nextStep() {
  if (halted) {
    alert("–ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–≤–µ—Ä—à–∏–≤—Å—è.");
    return;
  }
  let program = getProgram();
  let applied = false;
  for (let i = 0; i < program.length; i++) {
    let {left, right, end} = program[i];
    let pos = currentWord.indexOf(left);
    if (pos !== -1) {
      // –∑–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –ø—Ä–∞–≤–∏–ª–æ
      currentWord = currentWord.replace(left, right);
      document.getElementById("currentWord").innerText = currentWord;
      highlightRow(i+1);
      applied = true;
      if (end) {
        halted = true;
        alert("–ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–≤–µ—Ä—à–∏–≤—Å—è (–∫—ñ–Ω—Ü–µ–≤–µ –ø—Ä–∞–≤–∏–ª–æ).");
      }
      return;
    }
  }
  if (!applied) {
    halted = true;
    alert("–ñ–æ–¥–Ω–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–µ. –ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–≤–µ—Ä—à–∏–≤—Å—è.");
  }
}

function startMachine() {
  while (!halted) {
    nextStep();
  }
}

function addRow() {
  let table = document.querySelector("#programTable tbody");
  let rowCount = table.rows.length + 1;
  let row = table.insertRow();
  row.innerHTML = `
    <td>${rowCount}</td>
    <td><input type="text"></td>
    <td><input type="text"></td>
    <td><input type="checkbox"></td>
    <td><button onclick="deleteRow(this)">‚ùå</button></td>
  `;
}

function deleteRow(btn) {
  let row = btn.parentNode.parentNode;
  row.parentNode.removeChild(row);
  let rows = document.querySelectorAll("#programTable tbody tr");
  rows.forEach((r, idx) => { r.cells[0].innerText = idx + 1; });
}
</script>

</body>
</html>
